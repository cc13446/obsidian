转载自`https://pdai.tech/`
# 知识体系
![[Pasted image 20220505142326.png]]

# 什么是Redis

Redis是一款内存高速缓存数据库。Redis全称为：**Remote Dictionary Server**，使用C语言编写，Redis是一个`key-value`存储系统（键值存储系统），支持丰富的数据类型，可用于缓存，事件发布或订阅，高速队列等场景。支持网络，提供字符串，哈希，列表，队列，集合结构直接存取，基于内存，可持久化。

# 为什么要使用Redis
Redis的特点：
1. 读写性能优异
2. 数据类型丰富
3. 原子性
4. 丰富的特性
    -   Redis支持 `publish/subscribe`，通知， key 过期等特性。
5. 持久化
6. 发布订阅
    -   Redis支持发布/订阅模式
7. 分布式

# Redis的使用场景
## 热点数据的缓存
缓存是Redis最常见的应用场景，之所有这么使用，主要是因为Redis读写性能优异。而且逐渐有取代`memcached`，成为首选服务端缓存的组件。而且，Redis内部是支持事务的，在使用时候能有效保证数据的一致性。

作为缓存使用时，一般有两种方式保存数据：
1. 读取前，先去读Redis，如果没有数据，读取数据库，将数据拉入Redis。
	- 避免缓存击穿
	- 数据的实时性相对会差一点
	- 适用于对于数据实时性要求不是特别高的场景
2. 插入数据时，同时写入Redis。
	- 开发时不便于统一处理
	- 适用于字典表、数据量不大的数据存储

## 限时业务的运用

redis中可以使用expire命令设置一个键的生存时间，到时间后redis会删除它。利用这一特性可以运用在限时的优惠活动信息、手机验证码等业务场景。

## 计数器相关问题

redis由于`incrby`命令可以实现原子性的递增，所以可以运用于高并发的秒杀活动、分布式序列号的生成、具体业务还体现在比如限制一个手机号发多少条短信、一个接口一分钟限制多少请求、一个接口一天限制调用多少次等等。

## 分布式锁

这个主要利用redis的`setnx`命令进行，`set if not exists`就是如果不存在则成功设置缓存同时返回1，否则返回0 ，这个特性在很多后台中都有所运用，因为我们服务器是集群的，定时任务可能在两台机器上都会运行，所以在定时任务中首先通过`setnx`设置一个lock， 如果成功设置则执行，如果没有成功设置，则表明该定时任务已执行。 当然结合具体业务，我们可以给这个lock加一个过期时间，比如说30分钟执行一次的定时任务，那么这个过期时间设置为小于30分钟的一个时间就可以，这个与定时任务的周期以及定时任务执行消耗时间相关。在分布式锁的场景中，主要用在比如秒杀系统等。

## 延时操作

比如在订单生产后我们占用了库存，10分钟后去检验用户是否真正购买，如果没有购买将该单据设置无效，同时还原库存。 由于redis自`2.8.0`之后版本提供`Keyspace Notifications`功能，允许客户订阅`Pub/Sub`频道，以便以某种方式接收影响Redis数据集的事件。 所以我们对于上面的需求就可以用以下解决方案：
- 我们在订单生产时，设置一个key，同时设置10分钟后过期，
- 我们在后台实现一个监听器，监听key的实效，监听到key失效时将后续逻辑加上。

当然我们也可以利用rabbitmq、activemq等消息中间件的延迟队列服务实现该需求。

## 排行榜相关问题

关系型数据库在排行榜方面查询速度普遍偏慢，所以可以借助redis的`SortedSet`进行热点数据的排序。

比如点赞排行榜，做一个`SortedSet`, 然后以用户的`openid`作为上面的`username`, 以用户的点赞数作为上面的`score`, 然后针对每个用户做一个`hash`, 通过`zrangebyscore`就可以按照点赞数获取排行榜，然后再根据`username`获取用户的`hash`信息，这个当时在实际运用中性能体验也蛮不错的。

## 点赞、好友等相互关系的存储

Redis 利用集合的一些命令，比如求交集、并集、差集等。

在微博应用中，每个用户关注的人存在一个集合中，就很容易实现求两个人的共同好友功能。

## 简单队列
由于Redis有`list push`和`list pop`这样的命令，所以能够很方便的执行队列操作。